# âœ… Day 2: æ•°æ®åº“ Schema è®¾è®¡ - å®Œæˆæ€»ç»“

> **å®Œæˆæ—¶é—´**: 2025-11-13  
> **ä»»åŠ¡çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## ğŸ“‹ å®Œæˆçš„ä»»åŠ¡

### åˆ›å»ºäº† 8 ä¸ªæ•°æ®åº“è¡¨çš„ Schema å®šä¹‰ âœ…

æ‰€æœ‰è¡¨çš„ Schema æ–‡ä»¶å·²åˆ›å»ºåœ¨ `uniCloud-aliyun/database/` ç›®å½•ä¸‹ï¼š

| # | è¡¨å | æ–‡ä»¶å | ç”¨é€” | çŠ¶æ€ |
|---|------|--------|------|------|
| 1 | uni-id-users | `uni-id-users.schema.json` | ç”¨æˆ·è¡¨ï¼ˆæ‰©å±•ï¼‰ | âœ… |
| 2 | agents | `agents.schema.json` | æ™ºèƒ½ä½“è¡¨ | âœ… |
| 3 | web-cards | `web-cards.schema.json` | ç½‘é¡µå¡ç‰‡è¡¨ | âœ… |
| 4 | feishu-cards | `feishu-cards.schema.json` | é£ä¹¦å¡ç‰‡è¡¨ | âœ… |
| 5 | departments | `departments.schema.json` | éƒ¨é—¨è¡¨ | âœ… |
| 6 | cities | `cities.schema.json` | åŸå¸‚è¡¨ | âœ… |
| 7 | models | `models.schema.json` | AI æ¨¡å‹è¡¨ | âœ… |
| 8 | chat-history | `chat-history.schema.json` | å¯¹è¯å†å²è¡¨ | âœ… |

---

## ğŸ“Š æ•°æ®åº“è¡¨è¯¦ç»†è¯´æ˜

### 1. uni-id-users ç”¨æˆ·è¡¨

**æ‰©å±•å­—æ®µ**:
- `city` (int) - æ‰€å±åŸå¸‚ ID
- `city_name` (string) - åŸå¸‚åç§°
- `department` (string) - æ‰€å±éƒ¨é—¨ï¼ˆæšä¸¾ï¼‰
- `is_admin` (bool) - æ˜¯å¦ç®¡ç†å‘˜
- `avatar` (string) - å¤´åƒ URL
- `role` (array) - è§’è‰²åˆ—è¡¨
- `permission` (array) - æƒé™åˆ—è¡¨

**æ ¸å¿ƒç‰¹æ€§**:
- âœ… åŸºäº uni-id æ ‡å‡†æ‰©å±•
- âœ… æ”¯æŒéƒ¨é—¨å’ŒåŸå¸‚æƒé™
- âœ… è‡ªåŠ¨å¯†ç åŠ å¯†
- âœ… Token ç®¡ç†

---

### 2. agents æ™ºèƒ½ä½“è¡¨

**æ ¸å¿ƒå­—æ®µ**:
- `name` - æ™ºèƒ½ä½“åç§°
- `system_prompt` - ç³»ç»Ÿæç¤ºè¯
- `max_tokens` - æœ€å¤§ Token (é»˜è®¤ 2000)
- `temperature` - æ¸©åº¦å‚æ•° (é»˜è®¤ 0.7)
- `model_id` - å…³è” AI æ¨¡å‹
- `navigation_tab` - å¯¼èˆªæ ‡ç­¾ï¼ˆæ•™ç ”/æœåŠ¡/AIå·¥å…·ç®±ï¼‰
- `cities` - å…³è”åŸå¸‚ï¼ˆæ”¯æŒ ['all']ï¼‰
- `departments` - å…³è”éƒ¨é—¨ï¼ˆæ”¯æŒ ['all']ï¼‰

**ç‰¹æ®Šæ”¯æŒ**:
- âœ… OpenAI å’Œç«å±±å¼•æ“åŒæ”¯æŒ
- âœ… å›¾æ ‡é…ç½®ï¼ˆåç§°ã€ç±»å‹ã€é¢œè‰²ï¼‰
- âœ… å¯ç”¨/ç¦ç”¨çŠ¶æ€

---

### 3. web-cards ç½‘é¡µå¡ç‰‡è¡¨

**æ ¸å¿ƒå­—æ®µ**:
- `title` - å¡ç‰‡æ ‡é¢˜
- `url` - ç›®æ ‡ç½‘å€
- `open_mode` - æ‰“å¼€æ–¹å¼ (iframe/external/auto)
- `icon_name` - å›¾æ ‡åç§°
- `icon_color` - å›¾æ ‡é¢œè‰²
- `navigation_tab` - å¯¼èˆªæ ‡ç­¾
- `cities` / `departments` - æƒé™æ§åˆ¶

**ç‰¹æ€§**:
- âœ… æ”¯æŒå¤šç§æ‰“å¼€æ–¹å¼
- âœ… å›¾æ ‡è‡ªå®šä¹‰
- âœ… æƒé™æ§åˆ¶

---

### 4. feishu-cards é£ä¹¦å¡ç‰‡è¡¨

**æ ¸å¿ƒå­—æ®µ**:
- `title` - å¡ç‰‡æ ‡é¢˜
- `app_id` - é£ä¹¦åº”ç”¨ ID
- `app_secret` - é£ä¹¦åº”ç”¨å¯†é’¥
- `table_url` - é£ä¹¦è¡¨æ ¼ URL
- `display_fields` - æŠ˜å æ˜¾ç¤ºå­—æ®µ
- `filter_config` - ç­›é€‰é…ç½®

**ç‰¹æ€§**:
- âœ… é£ä¹¦å¤šç»´è¡¨æ ¼é›†æˆ
- âœ… å­—æ®µæ˜¾ç¤ºé…ç½®
- âœ… ç­›é€‰é…ç½®ç®¡ç†
- âœ… æƒé™æ§åˆ¶

---

### 5. departments éƒ¨é—¨è¡¨

**æ ¸å¿ƒå­—æ®µ**:
- `name` - éƒ¨é—¨åç§°
- `description` - éƒ¨é—¨æè¿°
- `sort_order` - æ’åº
- `is_active` - å¯ç”¨çŠ¶æ€

**é¢„è®¾éƒ¨é—¨**:
- ç»ç†
- é¡¾å®¢éƒ¨
- å¼€æ‹“éƒ¨
- æ•™ç ”éƒ¨
- å•†åŠ¡éƒ¨
- è´¢åŠ¡éƒ¨
- æ³•åŠ¡éƒ¨
- ä¼™ä¼´

---

### 6. cities åŸå¸‚è¡¨

**æ ¸å¿ƒå­—æ®µ**:
- `_id` - åŸå¸‚ IDï¼ˆæ•°å­—ï¼‰
- `name` - åŸå¸‚åç§°
- `code` - åŸå¸‚ä»£ç 
- `is_active` - å¯ç”¨çŠ¶æ€

---

### 7. models AI æ¨¡å‹è¡¨

**æ ¸å¿ƒå­—æ®µ**:
- `name` - æ¨¡å‹åç§°
- `api_url` - API åœ°å€
- `api_key` - API å¯†é’¥
- `model_type` - æ¨¡å‹ç±»å‹ (openai/volcengine/custom)

**ç”¨é€”**:
- âœ… ç®¡ç†å¤šä¸ª AI æ¨¡å‹é…ç½®
- âœ… æ”¯æŒ OpenAIã€ç«å±±å¼•æ“ç­‰
- âœ… ç»Ÿä¸€ API è°ƒç”¨ç®¡ç†

---

### 8. chat-history å¯¹è¯å†å²è¡¨

**æ ¸å¿ƒå­—æ®µ**:
- `user_id` - ç”¨æˆ· ID
- `agent_id` - æ™ºèƒ½ä½“ ID
- `messages` - æ¶ˆæ¯åˆ—è¡¨ï¼ˆæ•°ç»„ï¼‰
- `response` - AI å›å¤
- `usage` - Token ç”¨é‡ç»Ÿè®¡

**ç‰¹æ€§**:
- âœ… å®Œæ•´å¯¹è¯ä¸Šä¸‹æ–‡ä¿å­˜
- âœ… Token ç”¨é‡ç»Ÿè®¡
- âœ… æŒ‰ç”¨æˆ·å’Œæ™ºèƒ½ä½“æŸ¥è¯¢

---

## ğŸ“‚ æ–‡ä»¶ç»“æ„

```
tangzai-uniapp/uniCloud-aliyun/database/
â”œâ”€â”€ uni-id-users.schema.json        âœ… ç”¨æˆ·è¡¨
â”œâ”€â”€ agents.schema.json               âœ… æ™ºèƒ½ä½“è¡¨
â”œâ”€â”€ web-cards.schema.json            âœ… ç½‘é¡µå¡ç‰‡è¡¨
â”œâ”€â”€ feishu-cards.schema.json         âœ… é£ä¹¦å¡ç‰‡è¡¨
â”œâ”€â”€ departments.schema.json          âœ… éƒ¨é—¨è¡¨
â”œâ”€â”€ cities.schema.json               âœ… åŸå¸‚è¡¨
â”œâ”€â”€ models.schema.json               âœ… AI æ¨¡å‹è¡¨
â””â”€â”€ chat-history.schema.json         âœ… å¯¹è¯å†å²è¡¨
```

---

## ğŸ”‘ æ ¸å¿ƒè®¾è®¡ç‰¹æ€§

### 1. æƒé™æ§åˆ¶ç»Ÿä¸€ â­

æ‰€æœ‰å¡ç‰‡ç±»å‹ï¼ˆagentsã€web-cardsã€feishu-cardsï¼‰éƒ½åŒ…å«ï¼š
- `cities` - åŸå¸‚æƒé™ï¼ˆæ•°ç»„ï¼Œæ”¯æŒ ['all']ï¼‰
- `departments` - éƒ¨é—¨æƒé™ï¼ˆæ•°ç»„ï¼Œæ”¯æŒ ['all']ï¼‰
- `is_active` - å¯ç”¨çŠ¶æ€

### 2. æ—¶é—´æˆ³è‡ªåŠ¨ç®¡ç† â±ï¸

æ‰€æœ‰è¡¨éƒ½åŒ…å«ï¼š
- `created_at` - åˆ›å»ºæ—¶é—´ï¼ˆè‡ªåŠ¨ï¼‰
- `updated_at` - æ›´æ–°æ—¶é—´ï¼ˆè‡ªåŠ¨ï¼‰

### 3. æšä¸¾å€¼æ ‡å‡†åŒ– ğŸ“‹

- **å¯¼èˆªæ ‡ç­¾**: "æ•™ç ”" | "æœåŠ¡" | "AIå·¥å…·ç®±"
- **éƒ¨é—¨**: 8 ä¸ªæ ‡å‡†éƒ¨é—¨
- **æ¨¡å‹ç±»å‹**: "openai" | "volcengine" | "custom"

---

## ğŸ¯ ä¸‹ä¸€æ­¥ (Day 3)

### Day 3 ä»»åŠ¡é¢„è§ˆ

1. **åœ¨ uniCloud æ§åˆ¶å°åˆ›å»ºæ•°æ®åº“é›†åˆ**
   - [ ] ä¸Šä¼ æ‰€æœ‰ Schema æ–‡ä»¶
   - [ ] åœ¨æ§åˆ¶å°åˆ›å»º 8 ä¸ªé›†åˆ
   - [ ] éªŒè¯è¡¨ç»“æ„

2. **å‡†å¤‡æ•°æ®è¿ç§»è„šæœ¬**
   - [ ] åˆ›å»º MySQL æ•°æ®å¯¼å‡ºè„šæœ¬
   - [ ] åˆ›å»ºæ•°æ®æ ¼å¼è½¬æ¢è„šæœ¬
   - [ ] æµ‹è¯•æ•°æ®è½¬æ¢

3. **åˆå§‹åŒ–æµ‹è¯•æ•°æ®**
   - [ ] åˆ›å»ºç®¡ç†å‘˜è´¦å·
   - [ ] åˆ›å»ºæµ‹è¯•åŸå¸‚ï¼ˆä¸Šæµ·ã€åŒ—äº¬ç­‰ï¼‰
   - [ ] åˆ›å»ºæµ‹è¯•éƒ¨é—¨

---

## ğŸ“ ä¸‹ä¸€æ­¥æ“ä½œæŒ‡å—

### åœ¨ HBuilderX ä¸­åˆ›å»ºæ•°æ®åº“é›†åˆ

1. **æ‰“å¼€ uniCloud Web æ§åˆ¶å°**
   - å³é”®é¡¹ç›® â†’ æ‰“å¼€ uniCloud Web æ§åˆ¶å°
   - é€‰æ‹©ä½ çš„æœåŠ¡ç©ºé—´

2. **åˆ›å»ºæ•°æ®åº“é›†åˆ**
   - è¿›å…¥ "äº‘æ•°æ®åº“" â†’ "æ•°æ®åº“é›†åˆ"
   - ç‚¹å‡» "æ–°å»ºé›†åˆ"
   - é›†åˆåç§°è¾“å…¥ï¼š`uni-id-users`
   - ç‚¹å‡» "ç¼–è¾‘è¡¨ç»“æ„"
   - å¤åˆ¶ `uni-id-users.schema.json` å†…å®¹
   - ç²˜è´´åˆ° Schema ç¼–è¾‘å™¨
   - ä¿å­˜

3. **é‡å¤æ­¥éª¤ 2ï¼Œåˆ›å»ºå…¶ä»– 7 ä¸ªé›†åˆ**
   - `agents`
   - `web-cards`
   - `feishu-cards`
   - `departments`
   - `cities`
   - `models`
   - `chat-history`

---

## âœ… Day 2 å®Œæˆæ£€æŸ¥æ¸…å•

- [x] åˆ›å»º uni-id-users Schema
- [x] åˆ›å»º agents Schema
- [x] åˆ›å»º web-cards Schema
- [x] åˆ›å»º feishu-cards Schema
- [x] åˆ›å»º departments Schema
- [x] åˆ›å»º cities Schema
- [x] åˆ›å»º models Schema
- [x] åˆ›å»º chat-history Schema
- [x] ç¼–å†™å®Œæˆæ€»ç»“æ–‡æ¡£

---

## ğŸ’¡ æ³¨æ„äº‹é¡¹

### âš ï¸ Schema è®¾è®¡è¦ç‚¹

1. **å­—æ®µç±»å‹**
   - ä½¿ç”¨ `bsonType` å®šä¹‰ç±»å‹
   - timestamp ç”¨äºæ—¶é—´å­—æ®µ
   - array ç”¨äºåˆ—è¡¨å­—æ®µ
   - object ç”¨äºåµŒå¥—å¯¹è±¡

2. **é»˜è®¤å€¼**
   - ä½¿ç”¨ `defaultValue` è®¾ç½®é»˜è®¤å€¼
   - æ—¶é—´å­—æ®µä½¿ç”¨ `forceDefaultValue: { "$env": "now" }`

3. **å¿…å¡«å­—æ®µ**
   - åœ¨ `required` æ•°ç»„ä¸­åˆ—å‡ºå¿…å¡«å­—æ®µ
   - æ ¸å¿ƒæ ‡è¯†å­—æ®µå¿…é¡»å¿…å¡«

---

**å®Œæˆæ—¶é—´**: 2025-11-13  
**ä¸‹ä¸€æ­¥**: Day 3 - æ•°æ®åº“é›†åˆåˆ›å»ºä¸æ•°æ®è¿ç§»å‡†å¤‡

**å‡†å¤‡å¥½ç»§ç»­ Day 3 äº†å—ï¼Ÿ** ğŸš€
