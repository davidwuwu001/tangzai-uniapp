# Day 6 å®Œæˆæ€»ç»“ - APIå¯¹æ¥ä¸æ•°æ®ç¼“å­˜

## âœ… å·²å®Œæˆä»»åŠ¡

### 1. åˆ›å»ºå¡ç‰‡APIæœåŠ¡ (api/cards.js)
- [x] æ•™ç ”åŠ©æ‰‹ç›¸å…³API
- [x] ç½‘é¡µæœåŠ¡ç›¸å…³API
- [x] é£ä¹¦æ•°æ®ç›¸å…³API
- [x] æ”¶è—åŠŸèƒ½ç›¸å…³API

**è¡Œæ•°:** 83 è¡Œ

**APIåˆ—è¡¨:**
| å‡½æ•°å | è¯´æ˜ | å‚æ•° |
|--------|------|------|
| getAgents | è·å–æ•™ç ”åŠ©æ‰‹åˆ—è¡¨ | params: {search, city, department} |
| getAgentDetail | è·å–åŠ©æ‰‹è¯¦æƒ… | id |
| getWebCards | è·å–ç½‘é¡µæœåŠ¡åˆ—è¡¨ | params |
| getFeishuCards | è·å–é£ä¹¦å¡ç‰‡åˆ—è¡¨ | params |
| getFeishuDataDetail | è·å–é£ä¹¦æ•°æ®è¯¦æƒ… | id |
| favoriteCard | æ”¶è—å¡ç‰‡ | cardId, cardType |
| unfavoriteCard | å–æ¶ˆæ”¶è— | cardId |
| getMyFavorites | è·å–æˆ‘çš„æ”¶è— | - |

### 2. åˆ›å»ºæ•°æ®ç¼“å­˜å·¥å…· (utils/cache.js)
- [x] åŸºç¡€ç¼“å­˜æ“ä½œï¼ˆå¢åˆ æŸ¥æ”¹ï¼‰
- [x] ç¼“å­˜è¿‡æœŸæœºåˆ¶
- [x] å¸¦ç¼“å­˜çš„APIè¯·æ±‚å°è£…
- [x] ç¼“å­˜ä¿¡æ¯ç»Ÿè®¡

**è¡Œæ•°:** 175 è¡Œ

**æ ¸å¿ƒå‡½æ•°:**
| å‡½æ•°å | è¯´æ˜ | å‚æ•° |
|--------|------|------|
| setCache | è®¾ç½®ç¼“å­˜ | key, data, expireTime |
| getCache | è·å–ç¼“å­˜ | key |
| removeCache | åˆ é™¤ç¼“å­˜ | key |
| clearAllCache | æ¸…é™¤æ‰€æœ‰ç¼“å­˜ | - |
| cachedRequest | å¸¦ç¼“å­˜çš„APIè¯·æ±‚ | cacheKey, apiFn, forceRefresh, expireTime |
| getCacheInfo | è·å–ç¼“å­˜ç»Ÿè®¡ | - |

### 3. æ›´æ–°æ•™ç ”é¡µé¢æ”¯æŒçœŸå®API
- [x] å¯¼å…¥APIå’Œç¼“å­˜å·¥å…·
- [x] æ·»åŠ  useRealAPI å¼€å…³
- [x] å®ç°çœŸå®APIè¯·æ±‚ï¼ˆå¸¦ç¼“å­˜ï¼‰
- [x] ä¸‹æ‹‰åˆ·æ–°å¼ºåˆ¶æ›´æ–°ç¼“å­˜

---

## ğŸ”§ æŠ€æœ¯å®ç°

### æ•°æ®ç¼“å­˜æœºåˆ¶

**ç¼“å­˜æµç¨‹:**
```
ç”¨æˆ·è¯·æ±‚ â†’ æ£€æŸ¥ç¼“å­˜ â†’ ç¼“å­˜å­˜åœ¨ä¸”æœªè¿‡æœŸ â†’ è¿”å›ç¼“å­˜
                   â†“
              ç¼“å­˜ä¸å­˜åœ¨/å·²è¿‡æœŸ
                   â†“
              è¯·æ±‚API â†’ ä¿å­˜ç¼“å­˜ â†’ è¿”å›æ•°æ®
```

**ä¼˜åŠ¿:**
1. âš¡ å‡å°‘ç½‘ç»œè¯·æ±‚
2. ğŸ“‰ é™ä½æœåŠ¡å™¨å‹åŠ›
3. ğŸš€ æå‡åŠ è½½é€Ÿåº¦
4. ğŸ“¶ ç¦»çº¿å¯ç”¨ï¼ˆä½¿ç”¨è¿‡æœŸç¼“å­˜ï¼‰

**ç¼“å­˜é…ç½®:**
```javascript
// é»˜è®¤ç¼“å­˜æ—¶é—´ï¼š5åˆ†é’Ÿ
const DEFAULT_EXPIRE_TIME = 5 * 60 * 1000

// ç¼“å­˜é”®å‰ç¼€
const CACHE_PREFIX = 'cache_'
```

### ä½¿ç”¨ç¤ºä¾‹

#### åŸºç¡€ç¼“å­˜æ“ä½œ
```javascript
import { setCache, getCache, removeCache } from '@/utils/cache'

// è®¾ç½®ç¼“å­˜ï¼ˆé»˜è®¤5åˆ†é’Ÿè¿‡æœŸï¼‰
setCache('user_info', userData)

// è®¾ç½®ç¼“å­˜ï¼ˆè‡ªå®šä¹‰è¿‡æœŸæ—¶é—´ï¼š10åˆ†é’Ÿï¼‰
setCache('agents_list', agentsData, 10 * 60 * 1000)

// è·å–ç¼“å­˜
const data = getCache('user_info')

// åˆ é™¤ç¼“å­˜
removeCache('user_info')
```

#### å¸¦ç¼“å­˜çš„APIè¯·æ±‚
```javascript
import { cachedRequest } from '@/utils/cache'
import { getAgents } from '@/api/cards'

// è‡ªåŠ¨å¤„ç†ç¼“å­˜
const data = await cachedRequest(
  'agents_list',           // ç¼“å­˜é”®
  () => getAgents(),       // APIè¯·æ±‚å‡½æ•°
  false,                   // æ˜¯å¦å¼ºåˆ¶åˆ·æ–°
  10 * 60 * 1000          // ç¼“å­˜è¿‡æœŸæ—¶é—´
)
```

#### åœ¨é¡µé¢ä¸­ä½¿ç”¨
```vue
<script>
import { getAgents } from '@/api/cards'
import { cachedRequest } from '@/utils/cache'

export default {
  methods: {
    async loadCards(forceRefresh = false) {
      // å¸¦ç¼“å­˜çš„è¯·æ±‚
      const data = await cachedRequest(
        'agents_list',
        () => getAgents(),
        forceRefresh  // ä¸‹æ‹‰åˆ·æ–°æ—¶ä¼ true
      )
      this.cards = data || []
    }
  }
}
</script>
```

---

## ğŸ¯ åˆ‡æ¢çœŸå®API

ç›®å‰é»˜è®¤ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼Œåˆ‡æ¢åˆ°çœŸå®APIçš„æ­¥éª¤ï¼š

### æ­¥éª¤1ï¼šé…ç½®åç«¯åœ°å€
ç¼–è¾‘ `utils/config.js`ï¼Œå¡«å†™ä½ çš„ Vercel åœ°å€ï¼š
```javascript
const dev = {
  apiBaseUrl: 'https://tangzai-zhushou-1105.vercel.app'
}
```

### æ­¥éª¤2ï¼šå¯ç”¨çœŸå®API
åœ¨é¡µé¢ä¸­è®¾ç½® `useRealAPI = true`ï¼š
```javascript
// pages/teaching/teaching.vue
data() {
  return {
    useRealAPI: true  // æ”¹ä¸º true
  }
}
```

### æ­¥éª¤3ï¼šæµ‹è¯•
1. é‡æ–°ç¼–è¯‘é¡¹ç›®
2. æ‰“å¼€æ•™ç ”é¡µé¢
3. æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ï¼š
   - ç¬¬ä¸€æ¬¡ï¼š`è¯·æ±‚API: agents_list`
   - ç¬¬äºŒæ¬¡ï¼š`ä»ç¼“å­˜è¯»å–: agents_list`

---

## ğŸ“Š æ•°æ®æµå›¾

### é¦–æ¬¡åŠ è½½
```
æ•™ç ”é¡µé¢ â†’ loadCards()
    â†“
cachedRequest('agents_list', ...)
    â†“
getCache('agents_list') â†’ null
    â†“
getAgents() APIè¯·æ±‚
    â†“
setCache('agents_list', data)
    â†“
è¿”å›æ•°æ® â†’ é¡µé¢å±•ç¤º
```

### å†æ¬¡åŠ è½½ï¼ˆ5åˆ†é’Ÿå†…ï¼‰
```
æ•™ç ”é¡µé¢ â†’ loadCards()
    â†“
cachedRequest('agents_list', ...)
    â†“
getCache('agents_list') â†’ è¿”å›ç¼“å­˜
    â†“
ç›´æ¥è¿”å› â†’ é¡µé¢å±•ç¤º âš¡ï¸
```

### ä¸‹æ‹‰åˆ·æ–°
```
æ•™ç ”é¡µé¢ â†’ refreshCards()
    â†“
loadCards(true)  // forceRefresh = true
    â†“
cachedRequest(..., true)
    â†“
å¿½ç•¥ç¼“å­˜ï¼Œç›´æ¥è¯·æ±‚API
    â†“
æ›´æ–°ç¼“å­˜ â†’ è¿”å›æ–°æ•°æ®
```

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
test1113/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ auth.js          # è®¤è¯APIï¼ˆDay 2ï¼‰
â”‚   â””â”€â”€ cards.js         # å¡ç‰‡APIï¼ˆâœ¨ Day 6æ–°å¢ï¼‰
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ config.js        # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ request.js       # ç½‘ç»œè¯·æ±‚ï¼ˆDay 2ï¼‰
â”‚   â””â”€â”€ cache.js         # ç¼“å­˜å·¥å…·ï¼ˆâœ¨ Day 6æ–°å¢ï¼‰
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ UniversalCard/   # é€šç”¨å¡ç‰‡ç»„ä»¶ï¼ˆDay 5ï¼‰
â”‚   â””â”€â”€ CardGrid/        # ç½‘æ ¼å¸ƒå±€ç»„ä»¶ï¼ˆDay 5ï¼‰
â””â”€â”€ pages/
    â””â”€â”€ teaching/
        â””â”€â”€ teaching.vue # æ•™ç ”é¡µé¢ï¼ˆâœ… å·²æ›´æ–°ï¼‰
```

---

## ğŸ› æ³¨æ„äº‹é¡¹

### 1. åç«¯APIæ•°æ®æ ¼å¼

ç¡®ä¿åç«¯è¿”å›æ ¼å¼å¦‚ä¸‹ï¼š

**æˆåŠŸå“åº”:**
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "title": "æ•°å­¦åŠ©æ‰‹",
      "description": "...",
      "icon": "ğŸ“"
    }
  ]
}
```

**é”™è¯¯å“åº”:**
```json
{
  "code": 400,
  "message": "é”™è¯¯ä¿¡æ¯"
}
```

### 2. ç¼“å­˜é”®å‘½åè§„èŒƒ

å»ºè®®ä½¿ç”¨ä»¥ä¸‹å‘½åè§„èŒƒï¼š
```
agents_list         # æ•™ç ”åŠ©æ‰‹åˆ—è¡¨
agent_detail_123    # IDä¸º123çš„åŠ©æ‰‹è¯¦æƒ…
web_cards           # ç½‘é¡µæœåŠ¡åˆ—è¡¨
feishu_cards        # é£ä¹¦å¡ç‰‡åˆ—è¡¨
favorites           # æˆ‘çš„æ”¶è—
```

### 3. ç¼“å­˜è¿‡æœŸæ—¶é—´å»ºè®®

| æ•°æ®ç±»å‹ | å»ºè®®è¿‡æœŸæ—¶é—´ |
|---------|------------|
| åˆ—è¡¨æ•°æ® | 5åˆ†é’Ÿ |
| è¯¦æƒ…æ•°æ® | 10åˆ†é’Ÿ |
| ç”¨æˆ·ä¿¡æ¯ | 30åˆ†é’Ÿ |
| é™æ€é…ç½® | 1å°æ—¶ |

### 4. å†…å­˜ç®¡ç†

- å®šæœŸæ¸…ç†è¿‡æœŸç¼“å­˜
- é¿å…ç¼“å­˜å¤§é‡æ•°æ®
- åœ¨"æˆ‘çš„"é¡µé¢æ·»åŠ "æ¸…é™¤ç¼“å­˜"åŠŸèƒ½

---

## ğŸ“ ä¸‹ä¸€æ­¥ï¼ˆDay 7ï¼‰

Day 7 ä»»åŠ¡ï¼š
1. åˆ›å»ºä¸‹æ‹‰åˆ·æ–°å’Œä¸Šæ‹‰åŠ è½½æ›´å¤šç»„ä»¶
2. å®ç°æƒé™è¿‡æ»¤åŠŸèƒ½
3. ä¼˜åŒ–åˆ—è¡¨æ€§èƒ½
4. æ·»åŠ åŠ è½½éª¨æ¶å±

---

## ğŸ‰ æ€»ç»“

**Day 6 æˆæœï¼š**
- âœ… åˆ›å»ºå¡ç‰‡APIæœåŠ¡ï¼ˆ83è¡Œï¼‰
- âœ… åˆ›å»ºæ•°æ®ç¼“å­˜å·¥å…·ï¼ˆ175è¡Œï¼‰
- âœ… æ›´æ–°æ•™ç ”é¡µé¢æ”¯æŒçœŸå®API
- âœ… å®ç°æ™ºèƒ½ç¼“å­˜æœºåˆ¶

**æ€»è®¡æ–°å¢ä»£ç ï¼š** 258 è¡Œ

**æŠ€æœ¯äº®ç‚¹ï¼š**
1. å®Œæ•´çš„ç¼“å­˜æœºåˆ¶ï¼ˆå¸¦è¿‡æœŸæ—¶é—´ï¼‰
2. ç¼“å­˜é™çº§ç­–ç•¥ï¼ˆAPIå¤±è´¥æ—¶è¿”å›è¿‡æœŸç¼“å­˜ï¼‰
3. å¼ºåˆ¶åˆ·æ–°æ”¯æŒï¼ˆä¸‹æ‹‰åˆ·æ–°ï¼‰
4. ç¼“å­˜ç»Ÿè®¡åŠŸèƒ½ï¼ˆä¾¿äºè°ƒè¯•ï¼‰

**ç°åœ¨å¯ä»¥ï¼š**
1. âœ… ä»åç«¯è·å–çœŸå®æ•°æ®
2. âœ… è‡ªåŠ¨ç¼“å­˜å‡å°‘è¯·æ±‚
3. âœ… ä¸‹æ‹‰åˆ·æ–°å¼ºåˆ¶æ›´æ–°
4. âœ… ç¦»çº¿è®¿é—®ç¼“å­˜æ•°æ®

**å¾…åŠäº‹é¡¹ï¼š**
- [ ] é…ç½®çœŸå®åç«¯åœ°å€ï¼ˆutils/config.jsï¼‰
- [ ] åœ¨æœåŠ¡é¡µé¢åº”ç”¨API
- [ ] åœ¨"æˆ‘çš„"é¡µé¢æ·»åŠ æ¸…é™¤ç¼“å­˜åŠŸèƒ½
- [ ] æµ‹è¯•çœŸå®APIè¿æ¥

ğŸš€ æ•°æ®å±‚å·²å®Œå–„ï¼Œç»§ç»­å‰è¿›ï¼
