# 汤仔助手 - 客户端 & 管理端联合开发计划总览

> **版本**: v1.0  
> **创建日期**: 2025-11-15  
> **目标**: 协调客户端（60天）和管理端（18-20周）并行开发，确保高效协作、避免冲突  
> **架构**: uniapp + uniCloud（统一技术栈）

---

## 📊 一、项目概览

### 1.1 开发目标

| 子项目 | 目标 | 时间 | 负责团队 |
|--------|------|------|---------|
| **客户端（tangzai-uniapp）** | 用户端功能：工作台、智能体、AI对话、飞书数据、个人中心 | 60天（约3个月） | 客户端团队 |
| **管理端（tangzai-B）** | 管理面板：用户管理、城市/部门、智能体、网页卡片、飞书卡片 | 18-20周（约5个月） | 管理端团队 |

### 1.2 共享资源

- ✅ **统一数据库**: uniCloud 云数据库（已迁移完成）
- ✅ **统一云函数**: 客户端和管理端共用同一套云对象
- ✅ **统一代码仓库**: 同一个 uniapp 项目（不同子包）
- ✅ **统一技术栈**: uniapp + Vue 3 + uniCloud

### 1.3 核心挑战

| 挑战 | 影响程度 | 解决方案 |
|------|---------|---------|
| **云函数并发开发冲突** | 🔴 高 | 提前联合设计 API + 分工明确 + 每周联调 |
| **数据库 Schema 变更冲突** | 🟡 中 | 统一 Schema 文档 + 变更审批流程 |
| **进度不一致** | 🟡 中 | 分阶段上线：客户端先上线，管理端后上线 |
| **权限系统复杂** | 🔴 高 | 统一权限中间件 + 提前设计 |

---

## 🗓️ 二、整体时间线（20周 = 5个月）

```
Week 1-2  ┌─────────────────────────────────────────────┐
          │  阶段 0: 联合设计阶段（必须一起完成）        │
          │  - 云对象 API 设计                          │
          │  - 数据库 Schema 设计                       │
          │  - 权限系统设计                             │
          │  - 开发规范制定                             │
          └─────────────────────────────────────────────┘
                           ↓
Week 3-12 ┌──────────────────────┐  ┌──────────────────────┐
          │  客户端开发          │  │  管理端开发          │
          │  (并行开发阶段)      │  │  (并行开发阶段)      │
          │                      │  │                      │
          │  Week 3-4: UI        │  │  Week 3-6: 基础架构  │
          │  Week 5-8: 云函数    │  │  Week 7-10: 城市部门 │
          │  Week 9-10: 对接     │  │  Week 11-12: 用户    │
          │  Week 11-12: 测试    │  │                      │
          └──────────────────────┘  └──────────────────────┘
                           ↓                    ↓
Week 12   ┌─────────────────────────────────────────────┐
          │  里程碑 1: 客户端上线                       │
          │  - 用户可使用 APP                           │
          │  - 临时使用原 Next.js 管理后台              │
          └─────────────────────────────────────────────┘
                                                ↓
Week 13-20                          ┌──────────────────────┐
                                    │  管理端继续开发      │
                                    │  Week 13-16: 智能体  │
                                    │  Week 17-18: 飞书    │
                                    │  Week 19-20: 测试    │
                                    └──────────────────────┘
                                                ↓
Week 20   ┌─────────────────────────────────────────────┐
          │  里程碑 2: 管理端上线                       │
          │  - 完整 uniapp 架构                         │
          │  - 关闭原 Next.js 管理后台                  │
          └─────────────────────────────────────────────┘
```

---

## 🎯 三、关键里程碑与检查点

### 里程碑 0: 联合设计完成（Week 2 结束）

**交付物**：
- [ ] 📄 `云对象API设计文档-完整版.md`
- [ ] 📄 `数据库Schema设计文档-完整版.md`
- [ ] 📄 `权限系统设计文档.md`
- [ ] 📄 `开发协作规范.md`
- [ ] 🔧 权限中间件初始版本（`common/permission.js`）

**验收标准**：
- ✅ 双方团队达成一致，无异议
- ✅ 所有云对象方法定义清晰（参数、返回值、权限要求）
- ✅ 所有数据库表结构确定（字段、类型、索引）

---

### 里程碑 1: 客户端上线（Week 12）

**交付物**：
- [ ] ✅ 客户端 APP/小程序可发布
- [ ] ✅ 所有云函数（客户端部分）开发完成并测试通过
- [ ] ✅ 用户可正常使用所有功能

**管理端状态**：
- ⏱️ 管理端开发约 60% 完成（城市/部门/用户管理完成）
- 🔄 临时方案：保留原 Next.js 管理后台，或使用 uniCloud 控制台

---

### 里程碑 2: 管理端上线（Week 20）

**交付物**：
- [ ] ✅ 管理端 H5 可发布
- [ ] ✅ 所有云函数（管理端部分）开发完成并测试通过
- [ ] ✅ 管理员可正常使用所有管理功能

**系统状态**：
- ✅ 完整 uniapp + uniCloud 架构
- ✅ 关闭原 Next.js 管理后台

---

## 📞 四、协调机制

### 4.1 沟通机制

#### **每日站会（15分钟，线上/线下）**
- **时间**: 每天上午 10:00
- **参与者**: 客户端负责人 + 管理端负责人
- **内容**:
  - 昨天完成了什么
  - 今天计划做什么
  - 是否有阻碍（特别是云函数/数据库相关）
  - **重点**: 是否需要修改共享资源（云对象/数据库）

#### **每周联调会（1小时）**
- **时间**: 每周五下午 3:00-4:00
- **参与者**: 双方开发团队全员
- **内容**:
  1. 本周代码合并（解决冲突）
  2. 云函数联调测试（双方互相调用测试）
  3. 数据库变更同步
  4. 下周计划对齐
  5. 风险识别与解决

#### **关键里程碑评审会（2小时）**
- **时间**: Week 2 / Week 8 / Week 12 / Week 20
- **参与者**: 全体团队 + 项目负责人
- **内容**:
  - 里程碑交付物验收
  - 问题总结与经验分享
  - 下阶段计划调整

---

### 4.2 文档管理

#### **共享文档目录**
```
/docs/
  00-联合开发计划-总览.md              # 本文档
  01-云对象API设计文档-完整版.md       # 双方共同维护
  02-数据库Schema设计文档-完整版.md    # 双方共同维护
  03-权限系统设计文档.md               # 双方共同维护
  04-开发协作规范.md                   # 双方共同维护
  
  /client/
    客户端开发指导文档.md              # 客户端团队专用
  
  /admin/
    管理端开发指导文档.md              # 管理端团队专用
```

#### **文档更新规则**
1. 任何人修改共享文档，必须通知对方
2. 重要变更（云对象API、数据库Schema）需双方确认后修改
3. 每次修改记录版本号和变更日志

---

### 4.3 代码管理（Git 分支策略）

```
main (生产环境)
  ↑ 每周五合并
  ├─ dev-client (客户端开发分支)
  │   ├─ feature/client-workbench
  │   ├─ feature/client-ai-chat
  │   └─ feature/client-feishu
  │
  └─ dev-admin (管理端开发分支)
      ├─ feature/admin-user-management
      ├─ feature/admin-agent-management
      └─ feature/admin-city-management
```

**合并规则**：
1. **每周五下午 4:00 统一合并**（联调会后）
2. 合并前必须：
   - ✅ 本地测试通过
   - ✅ 云函数双方联调通过
   - ✅ 无明显冲突
3. 冲突解决原则：
   - 优先保留后合并的代码
   - 如有疑问，立即沟通协商
4. 合并后立即测试：
   - ✅ 客户端功能正常
   - ✅ 管理端功能正常

---

### 4.4 云函数开发协作规则

#### **规则 1: 方法命名区分**
```javascript
// ✅ 推荐：客户端方法和管理端方法分开命名
module.exports = {
  // 客户端方法
  async list(params) { ... },          // 客户端列表
  async detail(params) { ... },        // 客户端详情
  
  // 管理端方法
  async adminList(params) { ... },     // 管理端列表（支持复杂筛选）
  async create(params) { ... },        // 管理端创建
  async update(params) { ... },        // 管理端更新
  async delete(params) { ... }         // 管理端删除
}

// ❌ 避免：同一个方法既给客户端用又给管理端用
// 会导致参数混乱、权限逻辑复杂
```

#### **规则 2: 权限统一校验**
```javascript
// 所有云对象必须使用统一的权限中间件
const { checkPermission } = require('common/permission')

module.exports = {
  async list(params) {
    const uid = this.getUniIdToken().uid
    const filter = await checkPermission(uid, 'view', 'agent')
    // ... 查询逻辑
  },
  
  async create(params) {
    const uid = this.getUniIdToken().uid
    await checkPermission(uid, 'manage', 'agent') // 会抛出异常如果无权限
    // ... 创建逻辑
  }
}
```

#### **规则 3: 云对象变更申请流程**
如需修改已有云对象方法：
1. 在 GitHub Issues 或协作文档提出申请
2. 说明变更原因、影响范围
3. 双方确认后再修改
4. 修改后立即通知对方并联调测试

---

### 4.5 数据库变更管理

#### **Schema 变更流程**
```
发现需要变更
    ↓
提出变更申请（Issue/文档）
    ↓
双方评审确认
    ↓
更新 Schema 设计文档（记录版本号）
    ↓
在 uniCloud 控制台修改表结构
    ↓
双方同步更新本地代码
    ↓
联调测试
```

#### **变更申请模板**
```markdown
## 数据库变更申请

**提出人**: 张三（客户端团队）  
**日期**: 2025-11-20  
**表名**: agents  
**变更类型**: 新增字段  

### 变更内容
- 新增字段: `view_count` (number) - 查看次数
- 默认值: 0
- 索引: 否

### 变更原因
客户端需要统计智能体的查看次数，用于热门推荐

### 影响范围
- 客户端: 需要在 `agent/detail` 方法中增加 view_count++
- 管理端: 需要在管理界面展示此字段

### 是否通过
- [ ] 客户端确认
- [ ] 管理端确认
```

---

## ⚠️ 五、风险管理

### 5.1 风险清单

| 风险 | 概率 | 影响 | 预防措施 | 应对方案 |
|------|------|------|---------|---------|
| **云函数冲突导致双方无法工作** | 高 | 严重 | 提前联合设计 + 方法命名区分 | 使用独立的开发环境（dev-client / dev-admin 服务空间） |
| **数据库变更不同步** | 中 | 严重 | Schema 变更审批流程 | 每周五同步检查数据库一致性 |
| **客户端提前完成，管理端未完成** | 高 | 中等 | 提前规划临时方案 | 保留原 Next.js 管理后台作为过渡 |
| **权限系统漏洞** | 中 | 严重 | 统一权限中间件 + Code Review | 安全测试 + 渗透测试 |
| **进度延期** | 高 | 中等 | 每周检查进度 + 及时调整 | 砍掉非核心功能（如飞书高级功能） |

---

### 5.2 应急预案

#### **预案 1: 云函数严重冲突**
**触发条件**: 双方修改同一个云对象方法导致功能互相影响
**应对措施**:
1. 立即停止合并，回滚到上一个稳定版本
2. 召开紧急会议，重新设计冲突的方法
3. 临时使用独立的云对象（如 agent-client / agent-admin）

#### **预案 2: 客户端提前完成，管理端未完成**
**触发条件**: Week 12 客户端准备上线，但管理端只完成 60%
**应对措施**:
1. 客户端先上线，用户端功能可用
2. 临时方案选择：
   - **方案 A**: 保留原 Next.js 管理后台（推荐）
   - **方案 B**: 直接用 uniCloud 控制台手动管理
   - **方案 C**: 快速开发一个临时 Web 管理工具
3. 管理端继续开发，完成后再切换

#### **预案 3: 进度严重延期**
**触发条件**: Week 8 检查时发现进度落后超过 2 周
**应对措施**:
1. 评估延期原因（技术难点 / 人力不足 / 需求变更）
2. 调整计划：
   - 砍掉非核心功能（如飞书高级筛选）
   - 增加人手（临时支援）
   - 延长时间（客户端 → 75 天，管理端 → 24 周）

---

## 📋 六、检查清单

### 6.1 联合设计阶段检查清单（Week 2）

- [ ] **云对象 API 设计文档** 完成
  - [ ] 所有云对象列表确定（user / agent / web-card / feishu / chat / admin）
  - [ ] 每个云对象的方法定义清晰（参数、返回值、权限）
  - [ ] 客户端方法和管理端方法命名区分
  - [ ] 双方确认无异议

- [ ] **数据库 Schema 设计文档** 完成
  - [ ] 所有表结构确定（8个表）
  - [ ] 每个表的字段、类型、索引确定
  - [ ] 权限相关字段确定（cities / departments / is_active）
  - [ ] 双方确认无异议

- [ ] **权限系统设计文档** 完成
  - [ ] 权限模型确定（城市+部门+管理员三层）
  - [ ] 权限中间件接口定义
  - [ ] 所有资源的权限规则确定
  - [ ] 双方确认无异议

- [ ] **开发协作规范** 确定
  - [ ] Git 分支策略确定
  - [ ] 代码审查流程确定
  - [ ] 沟通机制确定（每日站会 + 每周联调）
  - [ ] 双方确认无异议

- [ ] **权限中间件初始版本** 开发完成
  - [ ] `common/permission.js` 实现完成
  - [ ] 包含 `checkPermission(uid, action, resource)` 方法
  - [ ] 单元测试通过
  - [ ] 双方联调测试通过

---

### 6.2 每周联调检查清单（Week 3-20）

**联调前（周五下午 3:00 前）**:
- [ ] 客户端团队：本周代码已提交到 `dev-client` 分支
- [ ] 管理端团队：本周代码已提交到 `dev-admin` 分支
- [ ] 双方：本地测试通过，无明显 Bug

**联调中（周五下午 3:00-4:00）**:
- [ ] 代码合并：解决冲突，合并到 `main` 分支
- [ ] 云函数测试：
  - [ ] 客户端调用云函数测试通过
  - [ ] 管理端调用云函数测试通过
  - [ ] 权限系统测试通过（普通用户 + 管理员）
- [ ] 数据库检查：
  - [ ] Schema 是否有变更
  - [ ] 双方是否同步
- [ ] 问题记录：记录本周遇到的问题和解决方案
- [ ] 下周计划：对齐下周开发内容

**联调后（周五下午 4:00 后）**:
- [ ] 合并后的代码部署到测试环境
- [ ] 双方快速回归测试（冒烟测试）
- [ ] 如有问题，立即修复或回滚

---

### 6.3 关键里程碑验收清单

#### **里程碑 0: 联合设计完成（Week 2）**
- [ ] 所有设计文档完成并双方确认
- [ ] 权限中间件初始版本开发完成并测试通过
- [ ] 开发环境搭建完成（dev-client / dev-admin 服务空间）
- [ ] 双方团队培训完成（uniCloud 开发规范）

#### **里程碑 1: 客户端上线（Week 12）**
- [ ] 客户端所有功能开发完成
- [ ] 客户端云函数开发完成并测试通过
- [ ] 客户端 APP/小程序打包成功
- [ ] 真机测试通过（iOS + Android）
- [ ] 性能测试通过（加载速度 < 3秒）
- [ ] 安全测试通过（无权限漏洞）
- [ ] 用户验收测试通过
- [ ] 临时管理方案确定（保留 Next.js 或其他）

#### **里程碑 2: 管理端上线（Week 20）**
- [ ] 管理端所有功能开发完成
- [ ] 管理端云函数开发完成并测试通过
- [ ] 管理端 H5 打包成功
- [ ] 大屏测试通过（1920x1080 + 1366x768）
- [ ] 权限测试通过（系统管理员 + 城市管理员）
- [ ] 功能测试通过（所有管理功能）
- [ ] 性能测试通过（1000+ 条数据）
- [ ] 管理员验收测试通过
- [ ] 原 Next.js 管理后台下线

---

## 🎯 七、成功标准

### 7.1 技术标准

| 指标 | 客户端 | 管理端 | 验收标准 |
|------|--------|--------|---------|
| **功能完整性** | 100% | 100% | 所有规划功能实现 |
| **云函数响应时间** | < 500ms | < 1000ms | 95% 请求满足 |
| **页面加载时间** | < 3秒 | < 5秒 | 首次加载 |
| **兼容性** | iOS/Android/H5/小程序 | H5（PC 浏览器） | 主流版本 |
| **安全性** | 无高危漏洞 | 无高危漏洞 | 安全测试通过 |
| **稳定性** | 崩溃率 < 0.5% | 无崩溃 | 7天监控 |

---

### 7.2 协作标准

- ✅ **沟通效率**: 问题响应时间 < 2小时
- ✅ **文档同步**: 文档更新后 24 小时内同步
- ✅ **冲突解决**: 云函数冲突 < 2次/周
- ✅ **联调成功率**: 每周联调一次通过率 > 90%

---

## 📞 八、联系方式与资源

### 8.1 团队联系方式

| 角色 | 姓名 | 负责内容 | 联系方式 |
|------|------|---------|---------|
| 项目负责人 | - | 整体协调、重大决策 | - |
| 客户端负责人 | - | 客户端开发、客户端云函数 | - |
| 管理端负责人 | - | 管理端开发、管理端云函数 | - |
| 技术架构师 | - | 云对象设计、权限系统、技术支持 | - |

---

### 8.2 关键资源

**技术文档**:
- uniCloud 官方文档: https://uniapp.dcloud.net.cn/uniCloud/
- uni-id 文档: https://uniapp.dcloud.net.cn/uniCloud/uni-id.html
- uniapp 官方文档: https://uniapp.dcloud.net.cn/

**协作工具**:
- 代码仓库: GitHub / Gitee
- 项目管理: JIRA / Trello / 飞书项目
- 文档协作: 语雀 / Notion / 飞书文档
- 即时通讯: 微信群 / 飞书群 / 钉钉群

**开发环境**:
- uniCloud 控制台: https://unicloud.dcloud.net.cn/
- HBuilderX IDE: https://www.dcloud.io/hbuilderx.html

---

## 🎉 九、总结

### 9.1 关键成功因素

1. ✅ **提前联合设计** - Week 1-2 必须双方一起完成设计
2. ✅ **清晰的分工** - 客户端方法 vs 管理端方法明确区分
3. ✅ **频繁的沟通** - 每日站会 + 每周联调
4. ✅ **统一的权限中间件** - 避免重复开发和漏洞
5. ✅ **灵活的计划调整** - 根据实际情况及时调整

### 9.2 预期收益

- ✅ **开发效率提升 40%** - 并行开发比串行开发快
- ✅ **上线时间提前** - 客户端可提前 2 个月上线
- ✅ **架构统一** - uniapp + uniCloud 一体化
- ✅ **长期维护成本降低** - 统一技术栈，减少维护复杂度

---

**文档版本**: v1.0  
**创建日期**: 2025-11-15  
**下次更新**: 2025-11-22（Week 2 联合设计完成后）

**附录**:
- [客户端开发指导文档](./客户端开发指导文档.md)
- [管理端开发指导文档](./管理端开发指导文档.md)
- [云对象API设计文档-完整版](./云对象API设计文档-完整版.md)（待创建）
- [数据库Schema设计文档-完整版](./数据库Schema设计文档-完整版.md)（待创建）
